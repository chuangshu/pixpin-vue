import{_ as ve,o as he,c as h,b as l,F as A,r as W,f as T,i as H,j,t as k,w as D,k as ge,l as me,g as d,h as g,m as U,n as pe}from"./index-BQcgjDF-.js";const fe={class:"annotator-container"},we={class:"annotator-content"},ye={class:"toolbar-section"},be={class:"tool-group"},_e={class:"tool-buttons"},xe=["onClick","title"],ke={class:"tool-icon"},Ce={class:"tool-name"},Me={key:0,class:"tool-group"},Re={class:"color-picker"},Ie=["onClick"],Te={key:1,class:"tool-group"},De={class:"width-value"},Le={key:2,class:"tool-group"},Pe={class:"width-value"},Se={class:"tool-actions"},Ae=["disabled"],We=["disabled"],Ue={class:"canvas-section"},Ee={class:"layers-section"},Be={class:"layers-list"},ze=["onClick"],$e={class:"layer-icon"},Fe={class:"layer-name"},Ve=["onClick"],qe={key:0,class:"empty-layers"},He={__name:"Annotator",setup(je){const E=ge(),i=d(null),c=d(null),N=d(null),B=d(null),u=d("draw"),m=d("#e94560"),p=d(3),M=d(15),R=d(!1),v=d([]),I=d(null),b=d([]),f=d([]),_=d([]),O=[{id:"draw",name:"ç”»ç¬”",icon:"âœï¸"},{id:"highlight",name:"é«˜äº®",icon:"ðŸ–ï¸"},{id:"arrow",name:"ç®­å¤´",icon:"âž¡ï¸"},{id:"rect",name:"çŸ©å½¢",icon:"â¬œ"},{id:"circle",name:"åœ†å½¢",icon:"â­•"},{id:"mosaic",name:"é©¬èµ›å…‹",icon:"ðŸ”²"},{id:"text",name:"æ–‡å­—",icon:"ðŸ“"}],X=["#e94560","#4ecdc4","#ffe66d","#95e1d3","#f38181","#aa96da","#fcbad3","#ffffff"];let r=null,s=null,w=null;const Y=()=>{!i.value||!c.value||(r=i.value.getContext("2d"),s=c.value.getContext("2d"),I.value&&G())},G=()=>{const a=I.value,e=900,t=600;let n=a.width,o=a.height;n>e&&(o=e/n*o,n=e),o>t&&(n=t/o*n,o=t),i.value.width=n,i.value.height=o,i.value.style.width=n+"px",i.value.style.height=o+"px",c.value.width=n,c.value.height=o,c.value.style.width=n+"px",c.value.style.height=o+"px",r&&w&&(r.clearRect(0,0,n,o),r.drawImage(w.canvas,0,0,n,o))},L=a=>{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{I.value=e;const t=document.createElement("canvas");t.width=e.width,t.height=e.height,w=t.getContext("2d"),w.drawImage(e,0,0),me(()=>{Y(),r&&r.drawImage(e,0,0,i.value.width,i.value.height)})},e.src=a},P=a=>{if(!I.value)return;R.value=!0;const e=i.value.getBoundingClientRect(),t=a.clientX-e.left,n=a.clientY-e.top;v.value=[{x:t,y:n}],s.clearRect(0,0,c.value.width,c.value.height),u.value==="arrow"?z(t,n,t,n):u.value==="rect"?$(t,n,0,0):u.value==="circle"&&F(t,n,0)},S=a=>{if(!R.value)return;const e=i.value.getBoundingClientRect(),t=a.clientX-e.left,n=a.clientY-e.top;if(u.value==="draw"||u.value==="highlight"||u.value==="mosaic")v.value.push({x:t,y:n}),u.value==="mosaic"?Z(t,n):Q();else if(u.value==="arrow"){s.clearRect(0,0,c.value.width,c.value.height);const o=v.value[0];z(o.x,o.y,t,n)}else if(u.value==="rect"){s.clearRect(0,0,c.value.width,c.value.height);const o=v.value[0];$(o.x,o.y,t-o.x,n-o.y)}else if(u.value==="circle"){s.clearRect(0,0,c.value.width,c.value.height);const o=v.value[0],y=Math.sqrt(Math.pow(t-o.x,2)+Math.pow(n-o.y,2));F(o.x,o.y,y)}},C=()=>{R.value&&(R.value=!1,r.drawImage(c.value,0,0),s.clearRect(0,0,c.value.width,c.value.height),(v.value.length>1||u.value!=="draw")&&V(),v.value=[])},J=a=>{const e=a.touches[0],t=new MouseEvent("mousedown",{clientX:e.clientX,clientY:e.clientY});P(t)},K=a=>{const e=a.touches[0],t=new MouseEvent("mousemove",{clientX:e.clientX,clientY:e.clientY});S(t)},Q=()=>{if(!(v.value.length<2)){s.clearRect(0,0,c.value.width,c.value.height),s.beginPath(),s.moveTo(v.value[0].x,v.value[0].y);for(let a=1;a<v.value.length;a++){const e=v.value[a];u.value==="highlight"?(s.strokeStyle=m.value+"40",s.lineWidth=p.value*3,s.globalAlpha=.4):(s.strokeStyle=m.value,s.lineWidth=p.value,s.globalAlpha=1),s.lineTo(e.x,e.y),s.stroke(),s.beginPath(),s.moveTo(e.x,e.y)}}},z=(a,e,t,n)=>{const y=Math.atan2(n-e,t-a);s.strokeStyle=m.value,s.fillStyle=m.value,s.lineWidth=p.value,s.beginPath(),s.moveTo(a,e),s.lineTo(t,n),s.stroke(),s.beginPath(),s.moveTo(t,n),s.lineTo(t-15*Math.cos(y-Math.PI/6),n-15*Math.sin(y-Math.PI/6)),s.lineTo(t-15*Math.cos(y+Math.PI/6),n-15*Math.sin(y+Math.PI/6)),s.closePath(),s.fill()},$=(a,e,t,n)=>{s.strokeStyle=m.value,s.lineWidth=p.value,s.strokeRect(a,e,t,n)},F=(a,e,t)=>{s.strokeStyle=m.value,s.lineWidth=p.value,s.beginPath(),s.arc(a,e,t,0,Math.PI*2),s.stroke()},Z=(a,e)=>{const t=M.value,n=r.getImageData(Math.max(0,a-t/2),Math.max(0,e-t/2),t,t);for(let o=0;o<n.data.length;o+=4*t){const y=n.data[o],re=n.data[o+1],de=n.data[o+2];for(let x=0;x<4*t&&o+x<n.data.length;x+=4)n.data[o+x]=y,n.data[o+x+1]=re,n.data[o+x+2]=de}r.putImageData(n,Math.max(0,a-t/2),Math.max(0,e-t/2))},V=()=>{f.value.push(i.value.toDataURL()),f.value.length>20&&f.value.shift(),_.value=[]},ee=()=>{if(f.value.length===0)return;_.value.push(i.value.toDataURL());const a=f.value.pop(),e=new Image;e.onload=()=>{r.clearRect(0,0,i.value.width,i.value.height),r.drawImage(e,0,0)},e.src=a},te=()=>{if(_.value.length===0)return;f.value.push(i.value.toDataURL());const a=_.value.pop(),e=new Image;e.onload=()=>{r.clearRect(0,0,i.value.width,i.value.height),r.drawImage(e,0,0)},e.src=a},q=()=>{confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ ‡æ³¨å—ï¼Ÿ")&&(r.clearRect(0,0,i.value.width,i.value.height),w&&r.drawImage(w.canvas,0,0,i.value.width,i.value.height),V())},ae=()=>{var a;(a=B.value)==null||a.click()},ne=a=>{const e=a.target.files[0];if(e){const t=new FileReader;t.onload=n=>{L(n.target.result)},t.readAsDataURL(e)}a.target.value=""},le=()=>{confirm("ç¡®å®šè¦é‡æ–°å¼€å§‹å—ï¼Ÿå½“å‰æ ‡æ³¨å°†è¢«æ¸…é™¤ã€‚")&&(b.value=[],f.value=[],_.value=[],w&&(r.clearRect(0,0,i.value.width,i.value.height),r.drawImage(w.canvas,0,0,i.value.width,i.value.height)))},se=()=>{const a=document.createElement("a");a.download=`annotated-${Date.now()}.png`,a.href=i.value.toDataURL("image/png"),a.click()},oe=a=>({draw:"âœï¸",highlight:"ðŸ–ï¸",arrow:"âž¡ï¸",rect:"â¬œ",circle:"â­•",mosaic:"ðŸ”²",text:"ðŸ“"})[a]||"ðŸ“Œ",ie=a=>{a.hidden=!a.hidden},ce=a=>{const e=b.value.findIndex(t=>t.id===a.id);e!==-1&&b.value.splice(e,1)},ue=()=>{confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å›¾å±‚å—ï¼Ÿ")&&(b.value=[],q())};return he(()=>{E.query.image?L(E.query.image):L("data:image/svg+xml,"+encodeURIComponent(`
      <svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
        <rect width="100%" height="100%" fill="#1a1a2e"/>
        <text x="400" y="300" font-family="Arial" font-size="24" fill="#b8b8d1" text-anchor="middle">
          ç‚¹å‡»"ä¸Šä¼ å›¾ç‰‡"å¼€å§‹æ ‡æ³¨
        </text>
      </svg>
    `))}),(a,e)=>(g(),h("div",fe,[e[8]||(e[8]=l("div",{class:"page-header"},[l("h1",null,"âœï¸ å›¾ç‰‡æ ‡æ³¨"),l("p",null,"åœ¨å›¾ç‰‡ä¸Šæ·»åŠ æ ‡æ³¨ï¼šç»˜å›¾ã€é«˜äº®ã€é©¬èµ›å…‹ã€ç®­å¤´")],-1)),l("div",we,[l("div",ye,[l("div",be,[e[2]||(e[2]=l("span",{class:"tool-group-label"},"å·¥å…·",-1)),l("div",_e,[(g(),h(A,null,W(O,t=>l("button",{key:t.id,class:U(["tool-btn",{active:u.value===t.id}]),onClick:n=>u.value=t.id,title:t.name},[l("span",ke,k(t.icon),1),l("span",Ce,k(t.name),1)],10,xe)),64))])]),u.value==="draw"||u.value==="highlight"?(g(),h("div",Me,[e[3]||(e[3]=l("span",{class:"tool-group-label"},"é¢œè‰²",-1)),l("div",Re,[(g(),h(A,null,W(X,t=>l("button",{key:t,class:U(["color-btn",{active:m.value===t}]),style:pe({background:t}),onClick:n=>m.value=t},null,14,Ie)),64))])])):T("",!0),u.value==="draw"||u.value==="arrow"?(g(),h("div",Te,[e[4]||(e[4]=l("span",{class:"tool-group-label"},"çº¿å®½",-1)),H(l("input",{type:"range","onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),min:"1",max:"20",class:"width-slider"},null,512),[[j,p.value]]),l("span",De,k(p.value)+"px",1)])):T("",!0),u.value==="mosaic"?(g(),h("div",Le,[e[5]||(e[5]=l("span",{class:"tool-group-label"},"é©¬èµ›å…‹å¼ºåº¦",-1)),H(l("input",{type:"range","onUpdate:modelValue":e[1]||(e[1]=t=>M.value=t),min:"5",max:"30",class:"width-slider"},null,512),[[j,M.value]]),l("span",Pe,k(M.value)+"px",1)])):T("",!0),l("div",Se,[l("button",{class:"btn btn-secondary",onClick:ee,disabled:f.value.length===0}," â†©ï¸ æ’¤é”€ ",8,Ae),l("button",{class:"btn btn-secondary",onClick:te,disabled:_.value.length===0}," â†ªï¸ é‡åš ",8,We),l("button",{class:"btn btn-secondary",onClick:q}," ðŸ—‘ï¸ æ¸…é™¤ ")])]),l("div",Ue,[l("div",{class:"canvas-wrapper",ref_key:"canvasWrapperRef",ref:N},[l("canvas",{ref_key:"canvasRef",ref:i,onMousedown:P,onMousemove:S,onMouseup:C,onMouseleave:C,onTouchstart:D(J,["prevent"]),onTouchmove:D(K,["prevent"]),onTouchend:D(C,["prevent"])},null,544),l("canvas",{ref_key:"tempCanvasRef",ref:c,class:"temp-canvas",onMousedown:P,onMousemove:S,onMouseup:C,onMouseleave:C},null,544)],512),l("div",{class:"canvas-actions"},[l("button",{class:"btn btn-primary",onClick:ae}," ðŸ“ ä¸Šä¼ å›¾ç‰‡ "),l("button",{class:"btn btn-secondary",onClick:se}," ðŸ’¾ ä¿å­˜æ ‡æ³¨ "),l("button",{class:"btn btn-secondary",onClick:le}," ðŸ”„ é‡æ–°å¼€å§‹ ")]),l("input",{type:"file",ref_key:"fileInputRef",ref:B,accept:"image/*",onChange:ne,hidden:""},null,544)]),l("div",Ee,[l("div",{class:"layers-header"},[e[6]||(e[6]=l("h3",null,"ðŸ“‹ å›¾å±‚",-1)),l("button",{class:"btn btn-secondary btn-sm",onClick:ue}," æ¸…é™¤å…¨éƒ¨ ")]),l("div",Be,[(g(!0),h(A,null,W(b.value,(t,n)=>(g(),h("div",{key:t.id,class:U(["layer-item",{visible:!t.hidden}]),onClick:o=>ie(t)},[l("span",$e,k(oe(t.type)),1),l("span",Fe,k(t.name),1),l("button",{class:"layer-delete",onClick:D(o=>ce(t),["stop"])},"Ã—",8,Ve)],10,ze))),128)),b.value.length===0?(g(),h("div",qe,[...e[7]||(e[7]=[l("p",null,"è¿˜æ²¡æœ‰æ ‡æ³¨",-1)])])):T("",!0)])])])]))}},Oe=ve(He,[["__scopeId","data-v-f5b3f785"]]);export{Oe as default};
